<!DOCTYPE html>
<html>
  <head>
    <title>AR.js Marker Once Only</title>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
      body { margin: 0; overflow: hidden; }
    </style>
  </head>
  <body>
    <a-scene embedded arjs="trackingMethod: best; sourceType: webcam;">
      
      <!-- marker only used for觸發 -->
      <a-marker preset="hiro" emitevents="true" id="hiroMarker"></a-marker>

      <!-- 模型一開始隱藏, 掃到後固定在場景 -->
      <a-entity id="treeModel"
        gltf-model="models/tree.glb"
        scale="0.5 0.5 0.5"
        rotation="0 0 0"
        position="0 0 0"
        visible="false"
        animation-mixer>
      </a-entity>

      <a-entity camera></a-entity>
    </a-scene>

    <script>
      const marker = document.querySelector('#hiroMarker');
      const model = document.querySelector('#treeModel');
      let placed = false;

      marker.addEventListener('markerFound', () => {
        if (!placed) {
          // 取得當下 marker 的位置與方向，放到場景裡
          const markerObj = marker.object3D;
          const pos = new THREE.Vector3();
          const rot = new THREE.Quaternion();
          const scale = new THREE.Vector3();
          markerObj.matrixWorld.decompose(pos, rot, scale);

          model.object3D.position.copy(pos);
          model.object3D.quaternion.copy(rot);
          model.object3D.scale.copy(scale);

          model.setAttribute('visible', true);
          placed = true; // 只放一次
        }
      });
    </script>
  </body>
</html>
